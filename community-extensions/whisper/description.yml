extension:
  name: whisper
  description: Speech-to-text transcription using whisper.cpp, OpenAI's Whisper model
  version: 0.1.0
  language: C++
  build: cmake
  license: MIT
  excluded_platforms: "linux_amd64_gcc4;linux_amd64_musl;linux_arm64;osx_amd64;windows_amd64;windows_amd64_mingw;windows_amd64_rtools;wasm_mvp;wasm_eh;wasm_threads"
  requires_toolchains: ""
  maintainers:
    - tobilg

repo:
  github: tobilg/duckdb-whisper
  ref: da6cdf0acb5e2fc5d8e63189cb14eaef332b0175

docs:
  hello_world: |
    -- Transcribe an audio file
    D SELECT whisper_transcribe('audio.wav', 'tiny.en');
    ┌──────────────────────────────────────────────────┐
    │           whisper_transcribe(...)                │
    │                   varchar                        │
    ├──────────────────────────────────────────────────┤
    │ Hello, this is a test of the whisper extension.  │
    └──────────────────────────────────────────────────┘

    -- Get detailed transcription segments with timestamps
    D SELECT * FROM whisper_transcribe_segments('audio.wav', 'tiny.en');
    ┌────────────┬────────────┬──────────┬────────────────────┬────────────┬──────────┐
    │ segment_id │ start_time │ end_time │        text        │ confidence │ language │
    │   int32    │   double   │  double  │      varchar       │   double   │ varchar  │
    ├────────────┼────────────┼──────────┼────────────────────┼────────────┼──────────┤
    │          0 │       0.00 │     2.50 │ Hello, this is a   │       0.95 │ en       │
    │          1 │       2.50 │     4.00 │ test of whisper.   │       0.92 │ en       │
    └────────────┴────────────┴──────────┴────────────────────┴────────────┴──────────┘

    -- List available models
    D SELECT model_name, size_mb, is_downloaded FROM whisper_list_models() LIMIT 3;
    ┌────────────┬─────────┬───────────────┐
    │ model_name │ size_mb │ is_downloaded │
    │  varchar   │  int64  │    boolean    │
    ├────────────┼─────────┼───────────────┤
    │ tiny       │      75 │ false         │
    │ tiny.en    │      75 │ true          │
    │ base       │     142 │ false         │
    └────────────┴─────────┴───────────────┘

  extended_description: |
    A DuckDB extension for speech-to-text transcription using [whisper.cpp](https://github.com/ggml-org/whisper.cpp), the C/C++ port of OpenAI's Whisper model.

    ## Features

    - Transcribe audio files (WAV, MP3, FLAC, OGG, and more)
    - Live recording and transcription from microphone
    - Voice-to-SQL: speak natural language questions, get query results
    - Support for all Whisper models (tiny, base, small, medium, large)
    - Detailed transcription segments with timestamps and confidence scores
    - Automatic language detection or specify target language

    ## Quick Start

    ```sql
    -- Download a model first (or it downloads automatically)
    SELECT * FROM whisper_list_models();

    -- Transcribe an audio file
    SELECT whisper_transcribe('audio.wav', 'tiny.en');

    -- Get segments with timestamps
    SELECT * FROM whisper_transcribe_segments('audio.wav', 'tiny.en');

    -- Translate foreign audio to English
    SELECT whisper_translate('german_speech.mp3', 'small');
    ```

    ## Recording (requires microphone)

    ```sql
    -- List audio devices
    SELECT * FROM whisper_list_devices();

    -- Set device and record
    SET whisper_device_id = 0;
    SELECT whisper_record(5, 'tiny.en');

    -- Record until silence detected
    SELECT whisper_record_auto(30);
    ```

    ## Available Models

    | Model | Size | Description |
    |-------|------|-------------|
    | tiny/tiny.en | ~75MB | Fastest |
    | base/base.en | ~142MB | Fast |
    | small/small.en | ~466MB | Good balance |
    | medium/medium.en | ~1.5GB | High quality |
    | large-v3 | ~2.9GB | Best quality |

    Models with `.en` suffix are optimized for English.

    See the [GitHub repository](https://github.com/tobilg/duckdb-whisper) for full documentation.
